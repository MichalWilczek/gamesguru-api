<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Table Creation</title>
</head>
<body>
    <div id="offersList"></div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const TABLE_DIV_NAME = 'offersList';
        const OFFER_NAME = 'playstation 5 digital';
        const OFFERS_NUMBER = 10;
        const URL_GET_OFFERS = 'https://api.gamesguru.pl/api/offers';

        const sendRequest = async (method, url, params = {}) => {
            try {
                const response = await axios({
                    method: method,
                    url: url,
                    params
                });
                return response.data;
            } catch (error) {
                const result = {'status': 'error'};
                if (error.response.data.errorMessage) {
                    result['errorMessage'] = error.response.data.errorMessage;
                } else {
                    result['errorMessage'] = `Unexpected error when fetching data from ${url}. Error: ${error.response.data}`;
                }
                return result;
            }
        };

        const createWidget = (textContent, widgetClasses) => {
            const div = document.createElement('div');
            div.classList.add(...['elementor-element', 'elementor-widget', 'elementor-widget-text-editor']);
            div.classList.add(...widgetClasses);
            div.dataset.element_type = 'widget';
            div.dataset.widget_type = 'text-editor.default';
            
            const subDiv = document.createElement('div');
            subDiv.classList.add('elementor-widget-container');

            const subSubDiv = document.createElement('div');
            subSubDiv.classList.add(...['elementor-text-editor', 'elementor-clearfix']);

            if (textContent !== null) {
                const paragraph = document.createElement('p');
                paragraph.textContent = textContent;
                subSubDiv.append(paragraph);
            }

            subDiv.append(subSubDiv);
            div.append(subDiv);

            return div;
        }

        (async () => {
            const offers = await sendRequest('GET', URL_GET_OFFERS, {'name': OFFER_NAME, 'max_offers_no': OFFERS_NUMBER});

            const container = document.createElement('div');
            container.classList.add(...['elementor', 'elementor-125033']);

            const containerInner = document.createElement('div');
            containerInner.classList.add('elementor-inner');

            const sectionWrap = document.createElement('div');
            sectionWrap.classList.add('e-con-inner');

            for (let offer of offers) {
                
                const link = document.createElement('a');
                link.classList.add(...['elementor-element', 'elementor-element-1cb18cc5', 'lista-produkt-kafel', 'e-con-boxed', 'e-flex', 'e-con']);
                link.dataset.element_type = 'container';
                link.dataset.settings = '{&quot;content_width&quot;:&quot;boxed&quot;}';
                link.dataset.non_affiliated_url = offer['url'];
                link.href = offer['affiliation_url'];
                link.rel = 'nofollow noindex sponsored noreferrer noopener';
                link.target = '_blank';

                const linkDiv = document.createElement('div');
                linkDiv.classList.add('e-con-inner');

                const nameDiv = createWidget(offer['name'], ['elementor-element-52be0de3', 'elementor-widget-mobile__width-inherit', 'lista-produkt-tytul']);
                const priceDiv = createWidget(`${offer['price']} ${offer['currency']}`, ['elementor-element-6a0067ff', 'lista-produkt-cena']);
                const shopDiv = createWidget(offer['shop_name'], ['elementor-element-5aaec845', 'lista-produkt-rabat']);
                const smallUrlDiv = createWidget(null, ['elementor-element-7dbc075d', 'elementor-absolute', 'lista-produkt-cta']);

                linkDiv.append(nameDiv);
                linkDiv.append(priceDiv);
                linkDiv.append(shopDiv);
                linkDiv.append(smallUrlDiv);

                link.append(linkDiv);
                sectionWrap.append(link);
            }

            containerInner.append(sectionWrap);
            container.append(containerInner);

            // Append the table to the container div
            const offersList = document.getElementById(TABLE_DIV_NAME);
            offersList.appendChild(container);
        })();
    </script>

</body>
</html>
